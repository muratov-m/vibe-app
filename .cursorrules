# Vibe Coding Competition - Cursor Rules

## Project Overview
Backend Web API project for Vibe Coding competition using ASP.NET Core 9.0 with PostgreSQL.

## ⚠️ HACKATHON CONTEXT - READ FIRST!
**This is a Vibe Coding hackathon project. 40% of the final score depends on proper `docs/VIBE_LOG.md` documentation!**

The jury evaluates:
- How we leverage AI to overcome technical hurdles
- Our process organization and pipeline
- Errors encountered and how they were resolved
- Iterations: what didn't work → what helped → final solution

**DO NOT hide mistakes - they demonstrate real AI orchestration process!**

## CRITICAL RULES

### 1. Logging Requirement (CRITICAL - 40% of hackathon score!)
- **ALWAYS** log every user prompt and actions taken to `docs/VIBE_LOG.md`
- Log BEFORE making changes
- Each user request = new entry in log (including corrections/follow-ups)
- **Record current time** (⏱️) in prompt header, especially for error fixes

**MANDATORY STRUCTURE for each Prompt:**

```markdown
## Prompt #N ⏱️ HH:MM

### User Request
```
Full text of user's prompt
```

### Actions Taken
- What was done (brief)

### Errors & Issues (if any)
- What errors occurred
- How they were resolved
- What approaches didn't work

### User Corrections (if user made manual fixes)
- What user fixed manually
- Why AI solution was suboptimal
- What prompt/hint helped fix it

### Technical Decisions
- Why this approach was chosen
- What alternatives were considered
```

**IMPORTANT for jury:**
- Show ERRORS and how they were resolved (don't hide mistakes!)
- Document when AI suggested a bad solution and what helped fix it
- Describe the process: which prompt failed → which prompt worked
- Show iterations: first attempt → correction → final result

### 2. Technology Stack
- **Backend**: ASP.NET Core 9.0 Web API
- **Database**: PostgreSQL via Npgsql.EntityFrameworkCore.PostgreSQL 9.0+
- **Vector Extension**: pgvector (add only when RAG/embeddings needed)
- **ORM**: Entity Framework Core 9.0
- **Documentation**: Swagger/Swashbuckle

### 3. Dual Environment Support
Project must work in BOTH environments:

#### Local Development
- Connection string in `appsettings.Development.json`
- PostgreSQL on localhost:5432
- Swagger UI enabled

#### Render.com Production
- Use `DATABASE_URL` environment variable
- Auto-apply migrations on startup
- Health check endpoint at `/health`
- Docker deployment
- Parse Render PostgreSQL URL format: `postgres://user:pass@host:port/db`

### 4. Connection String Handling
- Support both local connection string and Render's `DATABASE_URL`
- Convert `postgres://` format to Npgsql connection string format
- Never hardcode sensitive data

### 5. pgvector Integration (only when needed)
- Add `Pgvector.EntityFrameworkCore` package
- Enable vector extension in PostgreSQL
- Use for RAG scenarios with embeddings

### 6. Best Practices
- Use async/await for database operations
- Use dependency injection properly:
  - **NEVER** inject `IServiceProvider` directly into services (Service Locator anti-pattern)
  - Use constructor injection for all dependencies
  - For background services needing scoped services, inject `IServiceScopeFactory` instead
- Database query optimization:
  - **NEVER** use `GetAllAsync().ToList()` then filter in memory
  - Use `GetQueryable()` or LINQ methods that translate to SQL
  - Apply filters with `.Where()` before `.ToList()` or `.FirstOrDefaultAsync()`
  - Use `.Select()` to load only needed fields (projection)
  - Use `FirstOrDefaultAsync(predicate)` instead of loading all and filtering
- Add proper error handling and logging
- Use DTOs for API responses
- Health check endpoint required
- Docker support required

### 7. Documentation Rules
- **NEVER** create architecture documents (ARCHITECTURE.md, etc.) unless explicitly requested
- **NEVER** create additional *.md files proactively
- Only update existing documentation when making changes
- Keep README.md concise and practical

## WORKFLOW
1. Log user prompt to `docs/VIBE_LOG.md`
2. Make requested changes
3. Update log with brief summary of actions taken
4. Ensure works locally AND on Render.com
5. Do NOT create documentation files unless explicitly asked
